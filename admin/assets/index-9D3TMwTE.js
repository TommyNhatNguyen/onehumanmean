import{r,b as F,u as J,d as Q,e as $,t as z,s as o,j as t,S as H,m as K,P as m,n as L,p as G}from"./index-BVwH0JCO.js";import{I as V}from"./index-GbeayIsc.js";import{S as d,A as Y,P as X,C as Z}from"./admin-DWtWyach.js";import{E as ee}from"./index-DpVfKpjL.js";import{U as te}from"./index-BDJbmgRz.js";import{u as ae}from"./useQuery-B7fEoWe5.js";import{M as se}from"./index-DBQp0F6-.js";import{B as u}from"./index-BdoJPm2o.js";import{E as oe}from"./index-DhJzi3-q.js";import"./clsx-B-dksMZM.js";import"./iconBase-LQJpegV3.js";const fe=()=>{var j,y,C,P;const[N,c]=r.useState(!1),x=F(),h=J(),v=Q(),{projectSlug:l}=$(),{data:n,error:f,isPending:g}=ae({queryKey:[l],queryFn:()=>G.getProjectsById(l),initialData:{}}),{author:S,category:p,content:b,position:T,thumbnail_url:U,title:_}=((j=n==null?void 0:n.data)==null?void 0:j.data)??{},[e,i]=r.useState({title:"",author:"",position:"",category:[],content:"",thumbnailUrl:""}),k={name:"file",multiple:!1,listType:"picture-card",maxCount:1,accept:".png, .jpeg, .jpg",action:"http://localhost:3000/admin/uploads",headers:{Authorization:`Bearer ${(C=(y=z)==null?void 0:y.get())==null?void 0:C.accessToken}`},onPreview:()=>{window.open(e.thumbnailUrl)},onChange(a){const{status:s}=a.file;s!=="uploading"&&console.log(a.file,a.fileList),s==="done"?(o.success(`${a.file.name} file uploaded successfully.`),i(W=>({...W,thumbnailUrl:a.file.response}))):s==="error"&&(o.error(`${a.file.name} file upload failed.`),a.file.error.status===403&&o.error(a.file.response.message))},onDrop(a){console.log("Dropped files",a.dataTransfer.files)}},O=a=>{i(s=>({...s,position:a}))},I=a=>{i(s=>({...s,category:[...a]}))},w=a=>{i(s=>({...s,author:a}))},E=a=>{i(s=>({...s,content:a}))},A=a=>{i(s=>({...s,title:a}))},D=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnailUrl:e.thumbnailUrl||""};x(K(a)),h(m.ADMIN.PROJECTS)}},M=()=>{c(!0)},R=()=>{c(!1)},B=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnail_url:e.thumbnailUrl||""};x(L({projectId:l,...a})),c(!1),h(m.ADMIN.PROJECTS)}},q=()=>{h(m.ADMIN.PROJECTS)};return r.useEffect(()=>{l&&v.resetQueries({queryKey:[l]},{cancelRefetch:!1})},[]),r.useEffect(()=>{var a;(a=n==null?void 0:n.data)!=null&&a.data&&i({title:_||"",author:S||"",position:T||"",category:(p==null?void 0:p.split(","))||[],content:b||"",thumbnailUrl:U||""})},[l,(P=n==null?void 0:n.data)==null?void 0:P.data]),t.jsxs("div",{className:"relative h-full w-full flex-shrink",children:[g&&!f&&t.jsx("div",{className:"absolute left-0 top-0 flex h-full min-h-[300px] w-full items-center justify-center",children:t.jsx(H,{className:"z-10"})}),f&&t.jsx(oe,{description:"Something went wrong, try refresh page"}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Title:"}),t.jsx(V,{onChange:a=>A(a.target.value),defaultValue:e.title,placeholder:"Title"})]}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Author"}),t.jsx(d,{handleChange:w,value:e.author,options:Y,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Position"}),t.jsx(d,{handleChange:O,value:e.position,options:X,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Category"}),t.jsx(d,{value:e.category,handleChange:I,options:Z,mode:"tags",tokenSeparators:[","],popupMatchSelectWidth:!1,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Content"}),t.jsx("div",{className:"ckeditor mt-[8px] min-w-[600px] max-w-[1017px]",children:t.jsx(ee,{itemSlug:l,initialData:b,initialDataLoading:g,handleChange:E})})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Upload thumbnail"}),t.jsx(te,{dragProps:k})]}),l?t.jsxs(t.Fragment,{children:[t.jsx(se,{open:N,handleCancel:R,handleOk:B,children:"Confirm update?"}),t.jsx(u,{onClick:M,tailClasses:"h-[42px] px-[24px] hover:bg-green-200 bg-[rgba(2,122,72,0.8)] mr-[8px]",children:"Update"}),t.jsx(u,{onClick:q,tailClasses:"h-[42px] px-[24px] hover:bg-red-200 bg-[rgba(193,21,116,0.8)]",children:"Cancel"})]}):t.jsx(u,{onClick:D,tailClasses:"h-[42px] px-[24px]",children:"Submit"})]})};export{fe as default};
