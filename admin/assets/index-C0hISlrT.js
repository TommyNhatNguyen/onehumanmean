import{r,b as G,u as W,h as $,i as F,E as Q,t as z,s as o,j as t,S as H,k as K,P as m,m as V,n as Y}from"./index-Cg89Cyj-.js";import{I as J}from"./index-DysHQxTB.js";import{S as d,A as X,P as Z,C as ee}from"./admin-BsST5Lv7.js";import{E as te}from"./index-rRSJv2ng.js";import{U as ae}from"./index-COBmdkdd.js";import{B as u}from"./index-BWmlc6CN.js";import{u as se}from"./useQuery-gewGhQcV.js";import{M as oe}from"./index-c-RXIZLT.js";import{E as ne}from"./index-eb78f0wY.js";import"./clsx-B-dksMZM.js";import"./iconBase-CEFIwy0P.js";const ge=()=>{var y,j,C,N;const[P,c]=r.useState(!1),x=G(),h=W(),v=$(),{blogSlug:l}=F(),{data:n,error:f,isPending:g}=se({queryKey:[l],queryFn:()=>Y.getBlogsById(l),initialData:{}}),{author:S,category:p,content:b,position:U,thumbnail_url:_,title:k}=((y=n==null?void 0:n.data)==null?void 0:y.data)??{},[e,i]=r.useState({title:"",author:"",position:"",category:[],content:"",thumbnailUrl:""}),T={name:"file",multiple:!1,listType:"picture-card",maxCount:1,accept:".png, .jpeg, .jpg",action:`${Q.BASE_URL}admin/uploads`,headers:{Authorization:`Bearer ${(C=(j=z)==null?void 0:j.get())==null?void 0:C.accessToken}`},onPreview:()=>{window.open(e.thumbnailUrl)},onChange(a){const{status:s}=a.file;s!=="uploading"&&console.log(a.file,a.fileList),s==="done"?(o.success(`${a.file.name} file uploaded successfully.`),i(q=>({...q,thumbnailUrl:a.file.response}))):s==="error"&&(o.error(`${a.file.name} file upload failed.`),a.file.error.status===403&&o.error(a.file.response.message))},onDrop(a){console.log("Dropped files",a.dataTransfer.files)}},O=a=>{i(s=>({...s,position:a}))},I=a=>{i(s=>({...s,category:[...a]}))},B=a=>{i(s=>({...s,author:a}))},w=a=>{i(s=>({...s,content:a}))},A=a=>{i(s=>({...s,title:a}))},E=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0?o.error("Please choose a category"):e.category.length>7&&o.error("Max category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnailUrl:e.thumbnailUrl||""};x(K(a)),h(m.ADMIN.BLOGS)}},D=()=>{c(!0)},M=()=>{c(!1)},L=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnail_url:e.thumbnailUrl||""};x(V({blogId:l,...a})),c(!1),h(m.ADMIN.BLOGS)}},R=()=>{h(m.ADMIN.BLOGS)};return r.useEffect(()=>{l&&v.resetQueries({queryKey:[l]},{cancelRefetch:!1})},[]),r.useEffect(()=>{var a;(a=n==null?void 0:n.data)!=null&&a.data&&i({title:k||"",author:S||"",position:U||"",category:(p==null?void 0:p.split(","))||[],content:b||"",thumbnailUrl:_||""})},[l,(N=n==null?void 0:n.data)==null?void 0:N.data]),t.jsxs("div",{className:"relative h-full w-full flex-shrink",children:[g&&!f&&t.jsx("div",{className:"absolute left-0 top-0 flex h-full min-h-[300px] w-full items-center justify-center",children:t.jsx(H,{className:"z-10"})}),f&&t.jsx(ne,{description:"Something went wrong, try refresh page"}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Title:"}),t.jsx(J,{onChange:a=>A(a.target.value),defaultValue:e.title,placeholder:"Title"})]}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Author"}),t.jsx(d,{handleChange:B,value:e.author,options:X,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Position"}),t.jsx(d,{handleChange:O,value:e.position,options:Z,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Category"}),t.jsx(d,{value:e.category,handleChange:I,options:ee,mode:"tags",tokenSeparators:[","],popupMatchSelectWidth:!1,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Content"}),t.jsx("div",{className:"ckeditor mt-[8px] min-w-[600px] max-w-[1017px]",children:t.jsx(te,{itemSlug:l,initialData:b,initialDataLoading:g,handleChange:w})})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Upload thumbnail"}),t.jsx(ae,{dragProps:T})]}),l?t.jsxs(t.Fragment,{children:[t.jsx(oe,{open:P,handleCancel:M,handleOk:L,children:"Confirm update?"}),t.jsx(u,{onClick:D,tailClasses:"h-[42px] px-[24px] hover:bg-green-200 bg-[rgba(2,122,72,0.8)] mr-[8px]",children:"Update"}),t.jsx(u,{onClick:R,tailClasses:"h-[42px] px-[24px] hover:bg-red-200 bg-[rgba(193,21,116,0.8)]",children:"Cancel"})]}):t.jsx(u,{onClick:E,tailClasses:"h-[42px] px-[24px]",children:"Submit"})]})};export{ge as default};
