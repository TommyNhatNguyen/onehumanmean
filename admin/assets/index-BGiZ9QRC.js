import{r,b as R,u as W,d as F,e as Q,t as $,s as o,j as t,S as z,f as H,P as d,g as K,h as V}from"./index-DQygTOy4.js";import{I as Y}from"./index-CM5eqlXm.js";import{S as m,A as J,P as X,C as Z}from"./admin-CA2BTl9e.js";import{E as ee}from"./index-CPmqCbuo.js";import{U as te}from"./index-Bff4YqD_.js";import{B as u}from"./index-B5pd-lMY.js";import{u as ae}from"./useQuery-BKxlWPQ_.js";import{M as se}from"./index-bnCCAK1k.js";import{E as oe}from"./index-GM2xAXwH.js";import"./clsx-B-dksMZM.js";import"./iconBase-D-_N70Je.js";const fe=()=>{var j,y,C,P;const[N,c]=r.useState(!1),x=R(),h=W(),v=F(),{blogSlug:l}=Q(),{data:n,error:f,isPending:g}=ae({queryKey:[l],queryFn:()=>V.getBlogsById(l),initialData:{}}),{author:S,category:p,content:b,position:U,thumbnail_url:_,title:T}=((j=n==null?void 0:n.data)==null?void 0:j.data)??{},[e,i]=r.useState({title:"",author:"",position:"",category:[],content:"",thumbnailUrl:""}),k={name:"file",multiple:!1,listType:"picture-card",maxCount:1,accept:".png, .jpeg, .jpg",action:"http://localhost:3000/admin/uploads",headers:{Authorization:`Bearer ${(C=(y=$)==null?void 0:y.get())==null?void 0:C.accessToken}`},onPreview:()=>{window.open(e.thumbnailUrl)},onChange(a){const{status:s}=a.file;s!=="uploading"&&console.log(a.file,a.fileList),s==="done"?(o.success(`${a.file.name} file uploaded successfully.`),i(G=>({...G,thumbnailUrl:a.file.response}))):s==="error"&&(o.error(`${a.file.name} file upload failed.`),a.file.error.status===403&&o.error(a.file.response.message))},onDrop(a){console.log("Dropped files",a.dataTransfer.files)}},O=a=>{i(s=>({...s,position:a}))},I=a=>{i(s=>({...s,category:[...a]}))},w=a=>{i(s=>({...s,author:a}))},B=a=>{i(s=>({...s,content:a}))},A=a=>{i(s=>({...s,title:a}))},D=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnailUrl:e.thumbnailUrl||""};x(H(a)),h(d.ADMIN.BLOGS)}},E=()=>{c(!0)},M=()=>{c(!1)},L=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnail_url:e.thumbnailUrl||""};x(K({blogId:l,...a})),c(!1),h(d.ADMIN.BLOGS)}},q=()=>{h(d.ADMIN.BLOGS)};return r.useEffect(()=>{l&&v.resetQueries({queryKey:[l]},{cancelRefetch:!1})},[]),r.useEffect(()=>{var a;(a=n==null?void 0:n.data)!=null&&a.data&&i({title:T||"",author:S||"",position:U||"",category:(p==null?void 0:p.split(","))||[],content:b||"",thumbnailUrl:_||""})},[l,(P=n==null?void 0:n.data)==null?void 0:P.data]),t.jsxs("div",{className:"relative h-full w-full flex-shrink",children:[g&&!f&&t.jsx("div",{className:"absolute left-0 top-0 flex h-full min-h-[300px] w-full items-center justify-center",children:t.jsx(z,{className:"z-10"})}),f&&t.jsx(oe,{description:"Something went wrong, try refresh page"}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Title:"}),t.jsx(Y,{onChange:a=>A(a.target.value),defaultValue:e.title,placeholder:"Title"})]}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Author"}),t.jsx(m,{handleChange:w,value:e.author,options:J,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Position"}),t.jsx(m,{handleChange:O,value:e.position,options:X,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Category"}),t.jsx(m,{value:e.category,handleChange:I,options:Z,mode:"tags",tokenSeparators:[","],popupMatchSelectWidth:!1,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Content"}),t.jsx("div",{className:"ckeditor mt-[8px] min-w-[600px] max-w-[1017px]",children:t.jsx(ee,{itemSlug:l,initialData:b,initialDataLoading:g,handleChange:B})})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Upload thumbnail"}),t.jsx(te,{dragProps:k})]}),l?t.jsxs(t.Fragment,{children:[t.jsx(se,{open:N,handleCancel:M,handleOk:L,children:"Confirm update?"}),t.jsx(u,{onClick:E,tailClasses:"h-[42px] px-[24px] hover:bg-green-200 bg-[rgba(2,122,72,0.8)] mr-[8px]",children:"Update"}),t.jsx(u,{onClick:q,tailClasses:"h-[42px] px-[24px] hover:bg-red-200 bg-[rgba(193,21,116,0.8)]",children:"Cancel"})]}):t.jsx(u,{onClick:D,tailClasses:"h-[42px] px-[24px]",children:"Submit"})]})};export{fe as default};
