import{r,b as $,u as F,d as J,e as L,E as Q,t as z,s as o,j as t,S as H,m as K,P as m,n as V,p as G}from"./index-DwQGl635.js";import{I as Y}from"./index-EUcvR-bP.js";import{S as d,A as X,P as Z,C as ee}from"./admin-Bi95cWqT.js";import{E as te}from"./index-z8ws2zg2.js";import{U as ae}from"./index-BOTG1wPf.js";import{u as se}from"./useQuery-C923Nqba.js";import{M as oe}from"./index-DCOVt2NH.js";import{B as u}from"./index-CtNl4sHn.js";import{E as ne}from"./index-BEslkPUz.js";import"./clsx-B-dksMZM.js";import"./iconBase-C6tjAN1W.js";const ge=()=>{var j,y,C,P;const[N,c]=r.useState(!1),x=$(),h=F(),v=J(),{projectSlug:i}=L(),{data:n,error:f,isPending:g}=se({queryKey:[i],queryFn:()=>G.getProjectsById(i),initialData:{}}),{author:S,category:p,content:b,position:U,thumbnail_url:T,title:_}=((j=n==null?void 0:n.data)==null?void 0:j.data)??{},[e,l]=r.useState({title:"",author:"",position:"",category:[],content:"",thumbnailUrl:""}),k={name:"file",multiple:!1,listType:"picture-card",maxCount:1,accept:".png, .jpeg, .jpg",action:`${Q.BASE_URL}admin/uploads`,headers:{Authorization:`Bearer ${(C=(y=z)==null?void 0:y.get())==null?void 0:C.accessToken}`},onPreview:()=>{window.open(e.thumbnailUrl)},onChange(a){const{status:s}=a.file;s!=="uploading"&&console.log(a.file,a.fileList),s==="done"?(o.success(`${a.file.name} file uploaded successfully.`),l(W=>({...W,thumbnailUrl:a.file.response}))):s==="error"&&(o.error(`${a.file.name} file upload failed.`),a.file.error.status===403&&o.error(a.file.response.message))},onDrop(a){console.log("Dropped files",a.dataTransfer.files)}},E=a=>{l(s=>({...s,position:a}))},O=a=>{l(s=>({...s,category:[...a]}))},I=a=>{l(s=>({...s,author:a}))},w=a=>{l(s=>({...s,content:a}))},A=a=>{l(s=>({...s,title:a}))},D=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnailUrl:e.thumbnailUrl||""};x(K(a)),h(m.ADMIN.PROJECTS)}},M=()=>{c(!0)},R=()=>{c(!1)},B=()=>{if(e.title===""&&o.error("Please fill in title field"),e.category.length===0&&o.error("Please choose a category"),e.content===""&&o.error("Please fill in content"),e.thumbnailUrl===""&&o.error("Please choose a thumbnail"),e.title!==""&&e.category.length!==0&&e.content!==""&&e.thumbnailUrl!==""){const a={title:e.title||"",author:e.author||"",position:e.position||"",category:e.category.join(","),content:e.content||"",thumbnail_url:e.thumbnailUrl||""};x(V({projectId:i,...a})),c(!1),h(m.ADMIN.PROJECTS)}},q=()=>{h(m.ADMIN.PROJECTS)};return r.useEffect(()=>{i&&v.resetQueries({queryKey:[i]},{cancelRefetch:!1})},[]),r.useEffect(()=>{var a;(a=n==null?void 0:n.data)!=null&&a.data&&l({title:_||"",author:S||"",position:U||"",category:(p==null?void 0:p.split(","))||[],content:b||"",thumbnailUrl:T||""})},[i,(P=n==null?void 0:n.data)==null?void 0:P.data]),t.jsxs("div",{className:"relative h-full w-full flex-shrink",children:[g&&!f&&t.jsx("div",{className:"absolute left-0 top-0 flex h-full min-h-[300px] w-full items-center justify-center",children:t.jsx(H,{className:"z-10"})}),f&&t.jsx(ne,{description:"Something went wrong, try refresh page"}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Title:"}),t.jsx(Y,{onChange:a=>A(a.target.value),defaultValue:e.title,placeholder:"Title"})]}),t.jsxs("div",{className:"mb-[16px] flex items-center gap-[8px]",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Author"}),t.jsx(d,{handleChange:I,value:e.author,options:X,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Position"}),t.jsx(d,{handleChange:E,value:e.position,options:Z,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]}),t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Category"}),t.jsx(d,{value:e.category,handleChange:O,options:ee,mode:"tags",tokenSeparators:[","],popupMatchSelectWidth:!1,width:"fit-content",styles:{minWidth:"120px",marginTop:"8px"}})]})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Content"}),t.jsx("div",{className:"ckeditor mt-[8px] min-w-[600px] max-w-[1017px]",children:t.jsx(te,{itemSlug:i,initialData:b,initialDataLoading:g,handleChange:w})})]}),t.jsxs("div",{className:"mb-[16px]",children:[t.jsx("h2",{className:"font-semibold text-h2-sm text-black-100",children:"Upload thumbnail"}),t.jsx(ae,{dragProps:k})]}),i?t.jsxs(t.Fragment,{children:[t.jsx(oe,{open:N,handleCancel:R,handleOk:B,children:"Confirm update?"}),t.jsx(u,{onClick:M,tailClasses:"h-[42px] px-[24px] hover:bg-green-200 bg-[rgba(2,122,72,0.8)] mr-[8px]",children:"Update"}),t.jsx(u,{onClick:q,tailClasses:"h-[42px] px-[24px] hover:bg-red-200 bg-[rgba(193,21,116,0.8)]",children:"Cancel"})]}):t.jsx(u,{onClick:D,tailClasses:"h-[42px] px-[24px]",children:"Submit"})]})};export{ge as default};
